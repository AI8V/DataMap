<!DOCTYPE html>
<html data-bs-theme="dark" lang="ar" data-bss-forced-theme="dark" dir="rtl">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>التصدير - DataMap Pro</title>
    <link rel="canonical" href="https://ai8v.com/export.html">
    <meta property="og:url" content="https://ai8v.com/export.html">
    <meta name="twitter:description" content="DataMap Pro أداة ويب تعمل بالكامل في المتصفح (صفر Backend) لتنظيف ودمج وتحليل وتصدير بيانات خرائط جوجل">
    <meta name="twitter:card" content="summary_large_image">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net; img-src 'self' https: data:; connect-src 'self';">
    <meta name="theme-color" content="#0f172a">
    <meta property="og:type" content="website">
    <meta name="twitter:title" content="DataMap Pro">
    <meta property="og:image" content="https://ai8v.com/assets/img/DataMap.png">
    <meta name="description" content="تصدير بيانات خرائط جوجل - DataMap Pro">
    <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="assets/img/fav180.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/img/fav16.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/img/fav16D.png" media="(prefers-color-scheme: dark)">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/img/fav32.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/img/fav32D.png" media="(prefers-color-scheme: dark)">
    <link rel="icon" type="image/png" sizes="180x180" href="assets/img/fav180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/img/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/img/icon-512.png">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="manifest" href="manifest.json" crossorigin="use-credentials">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cairo:400,600,800&amp;display=swap">
    <link rel="stylesheet" href="assets/css/common.css">
    <link rel="stylesheet" href="assets/css/export.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<body>    <a href="#mainContent" class="skip-link">تخطي إلى المحتوى الرئيسي</a>

    <div class="loading-overlay d-none" id="loadingOverlay" role="status" aria-live="polite" aria-label="جاري تجهيز التصدير">
        <div class="text-center">
            <div class="spinner-custom" aria-hidden="true"></div>
            <p class="loading-text" id="loadingText">جاري تجهيز التصدير...</p>
            <div class="loading-progress-container d-none" id="progressContainer">
                <div class="loading-progress-bar">
                    <div class="loading-progress-fill" id="progressFill"></div>
                </div>
                <p class="loading-progress-text" id="progressText"></p>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer" role="region" aria-label="الإشعارات" aria-live="polite"></div>

    <header>
        <nav class="navbar navbar-expand-lg navbar-dark sticky-top" aria-label="التنقل الرئيسي">
            <div class="container">
                <a class="navbar-brand" href="index.html">
                    <i class="bi bi-database-gear ms-2" aria-hidden="true"></i> DataMap Pro
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="تبديل القائمة">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item"><a class="nav-link" href="import.html"><i class="bi bi-cloud-upload ms-1" aria-hidden="true"></i> الاستيراد</a></li>
                        <li class="nav-item"><a class="nav-link" href="index.html"><i class="bi bi-table ms-1" aria-hidden="true"></i> إدارة البيانات</a></li>
                        <li class="nav-item"><a class="nav-link" href="analytics.html"><i class="bi bi-graph-up ms-1" aria-hidden="true"></i> التحليلات</a></li>
                        <li class="nav-item"><a class="nav-link active" href="export.html" aria-current="page"><i class="bi bi-download ms-1" aria-hidden="true"></i> التصدير</a></li>
                    </ul>
                    <div class="d-flex align-items-center gap-3">
                        <span class="badge bg-light text-dark" id="navRecordCount" aria-label="إجمالي السجلات">
                            <i class="bi bi-archive ms-1" aria-hidden="true"></i>
                            <span id="navTotalRecords">0</span> سجل
                        </span>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container py-4" id="mainContent">
        <h1 class="page-title"><i class="bi bi-download ms-2" aria-hidden="true"></i> تصدير البيانات</h1>
        <p class="page-subtitle">صدّر بياناتك النظيفة بالشكل والصيغة التي تناسبك</p>

        <div class="row g-4" id="exportCardsContainer">
            <div class="col-lg-6 order-lg-2">
                <section aria-labelledby="customExportHeading" class="export-card h-100">
                    <div class="export-card-header">
                        <div class="export-icon blue" aria-hidden="true"><i class="bi bi-sliders"></i></div>
                        <div>
                            <h2 id="customExportHeading" class="export-card-title">تصدير مخصص</h2>
                            <p class="export-card-desc">اختر الأعمدة التي تريدها</p>
                        </div>
                    </div>
                    <div class="export-card-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold">قوالب جاهزة:</label>
                            <div class="d-flex flex-wrap gap-2">
                                <button class="btn btn-outline-primary btn-sm" onclick="applyTemplate('contact')"><i class="bi bi-person-lines-fill ms-1" aria-hidden="true"></i> قائمة اتصال</button>
                                <button class="btn btn-outline-primary btn-sm" onclick="applyTemplate('marketing')"><i class="bi bi-megaphone ms-1" aria-hidden="true"></i> بيانات تسويقية</button>
                                <button class="btn btn-outline-primary btn-sm" onclick="applyTemplate('brief')"><i class="bi bi-card-list ms-1" aria-hidden="true"></i> بيانات مختصرة</button>
                            </div>
                        </div>
                        <div class="columns-selector" id="columnsSelector">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="form-label fw-bold mb-0">اختر الأعمدة:</label>
                                <div>
                                    <button class="btn btn-link btn-sm p-0 ms-3" onclick="selectAllColumns(true)">تحديد الكل</button>
                                    <button class="btn btn-link btn-sm p-0" onclick="selectAllColumns(false)">إلغاء الكل</button>
                                </div>
                            </div>
                            <div class="columns-grid" id="columnsGrid"></div>
                        </div>
                        <div class="d-flex gap-2 mt-3">
                            <button class="btn btn-primary flex-fill" onclick="exportCustom('xlsx')"><i class="bi bi-file-earmark-excel ms-1" aria-hidden="true"></i> Excel</button>
                            <button class="btn btn-outline-primary flex-fill" onclick="exportCustom('csv')"><i class="bi bi-filetype-csv ms-1" aria-hidden="true"></i> CSV</button>
                        </div>
                    </div>
                </section>
            </div>

            <div class="col-lg-6 order-lg-1">
                <div class="d-flex flex-column gap-4 h-100">
                    <section aria-labelledby="fullExportHeading" class="export-card">
                        <div class="export-card-header">
                            <div class="export-icon green" aria-hidden="true"><i class="bi bi-file-earmark-excel"></i></div>
                            <div>
                                <h2 id="fullExportHeading" class="export-card-title">تصدير كامل</h2>
                                <p class="export-card-desc">تصدير جميع البيانات بكل الأعمدة الـ 42</p>
                            </div>
                        </div>
                        <div class="export-card-body">
                            <div class="export-info mb-3">
                                <span class="export-info-item"><i class="bi bi-database ms-1" aria-hidden="true"></i> <span id="fullExportCount">0</span> سجل</span>
                                <span class="export-info-item"><i class="bi bi-layout-three-columns ms-1" aria-hidden="true"></i> 42 عمود</span>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-success flex-fill" onclick="exportFull('xlsx')"><i class="bi bi-file-earmark-excel ms-1" aria-hidden="true"></i> Excel</button>
                                <button class="btn btn-outline-success flex-fill" onclick="exportFull('csv')"><i class="bi bi-filetype-csv ms-1" aria-hidden="true"></i> CSV</button>
                            </div>
                        </div>
                    </section>

                    <section aria-labelledby="filteredExportHeading" class="export-card flex-fill">
                        <div class="export-card-header">
                            <div class="export-icon orange" aria-hidden="true"><i class="bi bi-funnel"></i></div>
                            <div>
                                <h2 id="filteredExportHeading" class="export-card-title">تصدير مفلتر</h2>
                                <p class="export-card-desc">صدّر بيانات مدينة أو تصنيف أو كلمة مفتاحية محددة</p>
                            </div>
                        </div>
                        <div class="export-card-body filtered-export-body">
                            <div class="filtered-export-scrollable">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">المدينة</label>
                                        <div class="multi-select-wrapper" id="expCityWrapper" data-filter-key="expCity">
                                            <button type="button" class="multi-select-toggle" id="expCityToggle" aria-haspopup="listbox" aria-expanded="false">
                                                <span class="toggle-text">جميع المدن</span>
                                                <span class="toggle-badge d-none">0</span>
                                                <i class="bi bi-chevron-down toggle-arrow" aria-hidden="true"></i>
                                            </button>
                                            <div class="multi-select-dropdown" id="expCityDropdown" role="listbox" aria-label="اختيار المدن للتصدير">
                                                <div class="multi-select-search"><input type="text" placeholder="بحث..." aria-label="بحث في المدن"></div>
                                                <div class="multi-select-options" id="expCityOptions"></div>
                                                <div class="multi-select-actions">
                                                    <button type="button" onclick="expMultiSelectAll('expCity')">تحديد الكل</button>
                                                    <button type="button" onclick="expMultiClearAll('expCity')">إلغاء الكل</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">التصنيف</label>
                                        <div class="multi-select-wrapper" id="expCategoryWrapper" data-filter-key="expCategory">
                                            <button type="button" class="multi-select-toggle" id="expCategoryToggle" aria-haspopup="listbox" aria-expanded="false">
                                                <span class="toggle-text">جميع التصنيفات</span>
                                                <span class="toggle-badge d-none">0</span>
                                                <i class="bi bi-chevron-down toggle-arrow" aria-hidden="true"></i>
                                            </button>
                                            <div class="multi-select-dropdown" id="expCategoryDropdown" role="listbox" aria-label="اختيار التصنيفات للتصدير">
                                                <div class="multi-select-search"><input type="text" placeholder="بحث..." aria-label="بحث في التصنيفات"></div>
                                                <div class="multi-select-options" id="expCategoryOptions"></div>
                                                <div class="multi-select-actions">
                                                    <button type="button" onclick="expMultiSelectAll('expCategory')">تحديد الكل</button>
                                                    <button type="button" onclick="expMultiClearAll('expCategory')">إلغاء الكل</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">الكلمة المفتاحية</label>
                                        <div class="multi-select-wrapper" id="expKeywordWrapper" data-filter-key="expKeyword">
                                            <button type="button" class="multi-select-toggle" id="expKeywordToggle" aria-haspopup="listbox" aria-expanded="false">
                                                <span class="toggle-text">جميع الكلمات</span>
                                                <span class="toggle-badge d-none">0</span>
                                                <i class="bi bi-chevron-down toggle-arrow" aria-hidden="true"></i>
                                            </button>
                                            <div class="multi-select-dropdown" id="expKeywordDropdown" role="listbox" aria-label="اختيار الكلمات المفتاحية للتصدير">
                                                <div class="multi-select-search"><input type="text" placeholder="بحث..." aria-label="بحث في الكلمات"></div>
                                                <div class="multi-select-options" id="expKeywordOptions"></div>
                                                <div class="multi-select-actions">
                                                    <button type="button" onclick="expMultiSelectAll('expKeyword')">تحديد الكل</button>
                                                    <button type="button" onclick="expMultiClearAll('expKeyword')">إلغاء الكل</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">الهاتف</label>
                                        <select class="form-select" id="expFilterPhone" onchange="updateFilteredCount()">
                                            <option value="">الكل</option>
                                            <option value="yes">يوجد رقم</option>
                                            <option value="no">بدون رقم</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">الموقع الإلكتروني</label>
                                        <select class="form-select" id="expFilterWebsite" onchange="updateFilteredCount()">
                                            <option value="">الكل</option>
                                            <option value="yes">يوجد موقع</option>
                                            <option value="no">بدون موقع</option>
                                        </select>
                                        <small class="text-muted d-none mt-1" id="expWebsiteFilterNote" style="font-size: 0.75rem; line-height: 1.3; display: block;">
                                            <i class="bi bi-info-circle ms-1" aria-hidden="true"></i>
                                            عدم وجود موقع في البيانات لا يعني عدم وجوده فعلياً — يُنصح بالبحث عن اسم النشاط في جوجل
                                        </small>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-bold">المراجعات</label>
                                        <select class="form-select" id="expFilterReviews" onchange="updateFilteredCount()">
                                            <option value="">الكل</option>
                                            <option value="0">بدون مراجعات</option>
                                            <option value="lt10">أقل من 10</option>
                                            <option value="gte10">10 فأكثر</option>
                                            <option value="gte50">50 فأكثر</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="filtered-export-footer">
                                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
                                    <span class="export-info-item"><i class="bi bi-funnel-fill ms-1" aria-hidden="true"></i> <span id="filteredExportCount">0</span> سجل مطابق</span>
                                    <small class="text-muted">
                                        <i class="bi bi-layout-three-columns ms-1" aria-hidden="true"></i>
                                        <span id="filteredColumnsCount">42</span> عمود —
                                        <a href="javascript:void(0)" onclick="scrollToColumnsSelector()" class="link-primary">تعديل من التصدير المخصص</a>
                                    </small>
                                </div>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-warning flex-fill" onclick="exportFiltered('xlsx')"><i class="bi bi-file-earmark-excel ms-1" aria-hidden="true"></i> Excel</button>
                                    <button class="btn btn-outline-warning flex-fill" onclick="exportFiltered('csv')"><i class="bi bi-filetype-csv ms-1" aria-hidden="true"></i> CSV</button>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <div class="empty-state-page d-none" id="exportEmpty">
            <i class="bi bi-inbox" aria-hidden="true"></i>
            <h3>لا توجد بيانات للتصدير</h3>
            <p>قم باستيراد بيانات أولاً من صفحة الاستيراد، أو استعد نسخة احتياطية من الأسفل</p>
            <a href="import.html" class="btn btn-primary mt-3"><i class="bi bi-cloud-upload ms-1" aria-hidden="true"></i> استيراد بيانات</a>
        </div>

        <div class="row g-4 mt-0" id="alwaysVisibleSection">
            <div class="col-lg-6">
                <section aria-labelledby="backupHeading" class="export-card">
                    <div class="export-card-header">
                        <div class="export-icon purple" aria-hidden="true"><i class="bi bi-shield-check"></i></div>
                        <div>
                            <h2 id="backupHeading" class="export-card-title">النسخ الاحتياطي</h2>
                            <p class="export-card-desc">احفظ نسخة احتياطية واستعدها في أي وقت</p>
                        </div>
                    </div>
                    <div class="export-card-body">
                        <div class="row g-3">
                            <div class="col-12" id="backupExportSection">
                                <div class="backup-section">
                                    <h3 class="h6 mb-2"><i class="bi bi-cloud-arrow-down ms-1" aria-hidden="true"></i> تصدير نسخة احتياطية</h3>
                                    <p class="text-muted small mb-2">يتم حفظ كل البيانات وسجل الاستيرادات بصيغة JSON</p>
                                    <button class="btn btn-purple w-100" onclick="exportBackup()"><i class="bi bi-download ms-1" aria-hidden="true"></i> تصدير نسخة احتياطية (JSON)</button>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="backup-section">
                                    <h3 class="h6 mb-2"><i class="bi bi-cloud-arrow-up ms-1" aria-hidden="true"></i> استعادة نسخة احتياطية</h3>
                                    <p class="text-muted small mb-2">استعد بياناتك من ملف JSON سبق تصديره</p>
                                    <div class="restore-zone" id="restoreZone" role="button" tabindex="0" aria-label="اضغط لاختيار ملف النسخة الاحتياطية">
                                        <i class="bi bi-upload" aria-hidden="true"></i>
                                        <span>اضغط لاختيار ملف JSON</span>
                                    </div>
                                    <input type="file" id="restoreInput" class="d-none" accept=".json">
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            <div class="col-lg-6" id="dangerZoneWrapper">
                <section aria-labelledby="dangerHeading" class="export-card danger-zone h-100">
                    <div class="export-card-header">
                        <div class="export-icon red" aria-hidden="true"><i class="bi bi-exclamation-triangle"></i></div>
                        <div>
                            <h2 id="dangerHeading" class="export-card-title">منطقة الخطر</h2>
                            <p class="export-card-desc">إجراءات لا يمكن التراجع عنها</p>
                        </div>
                    </div>
                    <div class="export-card-body d-flex align-items-center">
                        <div class="d-flex flex-wrap gap-3 align-items-center justify-content-between w-100">
                            <div>
                                <p class="mb-1 fw-bold">مسح جميع البيانات</p>
                                <p class="text-muted small mb-0">سيتم حذف كل السجلات وسجل الاستيرادات نهائياً. تأكد من أخذ نسخة احتياطية أولاً.</p>
                            </div>
                            <button class="btn btn-outline-danger" onclick="clearAllData()"><i class="bi bi-trash3 ms-1" aria-hidden="true"></i> مسح كل البيانات</button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <div class="modal fade" id="clearModal" tabindex="-1" aria-labelledby="clearModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h2 class="modal-title h5" id="clearModalTitle"><i class="bi bi-exclamation-triangle-fill ms-1" aria-hidden="true"></i> تأكيد مسح جميع البيانات</h2>
                    <button type="button" class="btn-close btn-close-white order-first" data-bs-dismiss="modal" aria-label="إغلاق"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <i class="bi bi-database-x text-danger" style="font-size: 4rem;" aria-hidden="true"></i>
                    <h3 class="mt-3 h5">هل أنت متأكد تماماً؟</h3>
                    <p class="text-muted">سيتم حذف <strong id="clearCount">0</strong> سجل وكل سجل الاستيرادات.</p>
                    <p class="text-danger fw-bold">هذا الإجراء لا يمكن التراجع عنه!</p>
                    <div class="mt-3">
                        <label class="form-label" for="clearConfirmInput">اكتب "<strong>حذف</strong>" للتأكيد:</label>
                        <input type="text" class="form-control text-center" id="clearConfirmInput" placeholder="اكتب: حذف" autocomplete="off">
                    </div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-danger px-4" id="btnConfirmClear" onclick="confirmClearAll()" disabled><i class="bi bi-trash3 ms-1" aria-hidden="true"></i> مسح نهائي</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="restoreModal" tabindex="-1" aria-labelledby="restoreModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h2 class="modal-title h5" id="restoreModalTitle"><i class="bi bi-exclamation-circle-fill ms-1" aria-hidden="true"></i> استعادة النسخة الاحتياطية</h2>
                    <button type="button" class="btn-close order-first" data-bs-dismiss="modal" aria-label="إغلاق"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <i class="bi bi-arrow-repeat text-warning" style="font-size: 4rem;" aria-hidden="true"></i>
                    <h3 class="mt-3 h5">تأكيد الاستعادة</h3>
                    <p class="text-muted">سيتم استبدال البيانات الحالية بالكامل ببيانات النسخة الاحتياطية.</p>
                    <div class="restore-preview mt-3" id="restorePreview"></div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-warning px-4" onclick="confirmRestore()"><i class="bi bi-cloud-arrow-up ms-1" aria-hidden="true"></i> استعادة</button>
                </div>
            </div>
        </div>
    </div>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/sw-register.js"></script>
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/db.js"></script>
    <script src="assets/js/xlsx.full.min.js"></script>
    <script src="assets/js/export.js"></script>
</body>

</html>